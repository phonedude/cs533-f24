
# Assignment 6: Node.js Express Browser Fingerprinting and Cloaking

This project implements a Node.js Express server that performs browser fingerprinting and demonstrates cloaking techniques. The server fingerprints clients using specific HTTP request headers, logs the fingerprints, recognizes returning clients, and serves unique content to each client based on their fingerprint. Additionally, it serves customized responses based on the client's User-Agent and IP address.

## Features

### Browser Fingerprinting

- Utilizes HTTP request headers to generate unique MD5-based fingerprints.
- Tracks returning clients and assigns them unique HTML pages.
- Logs fingerprints along with headers and timestamps to a server-side log (`fingerprints.log`).

### Cloaking

- Provides customized responses based on User-Agent and IP address.
- Handles command-line tool requests (e.g., `curl`, `wget`) with plain text responses.
- Serves a special HTML page for local IP addresses (`192.168.*.*`).

## Getting Started

### Prerequisites

- Node.js installed on your machine.

### Installation

#### Install Dependencies

```bash
npm install
```

### Running the Server

```bash
node server.js
```

The server will start running at [http://localhost:4000](http://localhost:4000).

## Fingerprinting

The server fingerprints clients using the following HTTP request headers:

- User-Agent
- Accept
- Accept-Language
- Accept-Encoding
- Cookies (if available)

Each fingerprint is generated by hashing these headers using the MD5 algorithm and is stored in `fingerprints.log`. Returning clients are recognized by their fingerprint and served the same unique content as before.

### Fingerprint Logging

Fingerprints are logged with the following structure:

```json
{
  "fingerprint": "139a2a7f3ac0d400bbd61e601d68a8a9",
  "headers": {
    "user-agent": "Mozilla/5.0...",
    "accept": "text/html,...",
    "accept-language": "en-US,en;q=0.9",
    "accept-encoding": "gzip, deflate, br",
    "cookies": {}
  },
  "timestamp": "2024-12-02T02:04:06.329Z"
}
```

## Cloaking Behavior

### Command-Line Tools (e.g., `curl`, `wget`)

Requests from User-Agents like `curl` or `wget` receive a plain text response:

```
Special response for CLI tools like curl or wget.
```

### Local IP Addresses (`192.168.*.*` or `10.27.*.*`)

Requests from local IP addresses are served a custom page:

- **File:** `local-user.html`

### Default Behavior

Other clients are fingerprinted and served unique content based on their fingerprints.

## Personalized Pages

Each new client is assigned a unique HTML page based on their fingerprint. The pages are named sequentially as `page-1.html`, `page-2.html`, `page-3.html`, etc. These pages can contain personalized content to provide a unique experience for each client.

**Note:** Ensure that the `html` directory contains these HTML files with content based on your four favorite things from Assignment 2.

## File Structure

```
6/
├── server.js               # Main server file
├── fingerprints.log        # Log file for fingerprints
├── html/                   # Directory containing HTML pages
│   ├── page-1.html
│   ├── page-2.html
│   ├── page-3.html
|   |── page-4.html
│   ├── ...
└── README.md               # This file
```

## Testing Instructions

### Start the Server

```bash
node server.js
```

### Test with Different Clients

Use at least six different browsers/devices to access [http://localhost:4000](http://localhost:4000):

- Desktop Browsers: Chrome, Firefox, Safari, Edge, Opera
- Mobile Devices: Smartphones, tablets
- Command-Line Tools: `curl`, `wget`

Each client should receive a unique page based on their fingerprint.

### Check Fingerprints Log

Open `fingerprints.log` to view the logged fingerprints, headers, and timestamps.

#### Example Logs

```json
{
  "fingerprint": "139a2a7f3ac0d400bbd61e601d68a8a9",
  "headers": {
    "user-agent": "Mozilla/5.0 (X11; Linux x86_64)...",
    "accept": "text/html,...",
    "accept-language": "en-US,en;q=0.9",
    "accept-encoding": "gzip, deflate, br",
    "cookies": {}
  },
  "timestamp": "2024-12-02T02:04:06.329Z"
}
{
  "fingerprint": "a4b7c9e8d6f2g1h0i2j3k4l5m6n7o8p9",
  "headers": {
    "user-agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64)...",
    "accept": "text/html,...",
    "accept-language": "en-US,en;q=0.8",
    "accept-encoding": "gzip, deflate",
    "cookies": {}
  },
  "timestamp": "2024-12-02T02:10:12.345Z"
}
```

## Echo Service

The server includes an `/echo` endpoint that returns a JSON response containing details about the client's request. This can be useful for testing and debugging.

### Usage

Access [http://localhost:4000/echo](http://localhost:4000/echo) from a browser or client.

### Response Structure

```json
{
  "method": "GET",
  "headers": {
    "user-agent": "Mozilla/5.0...",
    "accept": "application/json,...",
    ...
  },
  "client_ip": "::1",
  "time_utc": "2024-12-02T02:15:30.000Z",
  "info": "Echo service from this server"
}
```

## Notes

- Ensure the `html` directory contains the unique pages (`page-1.html`, `page-2.html`, etc.) with content based on your four favorite things from Assignment 2.
- Test thoroughly with different clients to generate distinct fingerprints and verify client recognition upon return visits.
- Use local IP addresses and command-line tools to test the cloaking behavior.
- Be cautious with the `fingerprints.log` file as it contains potentially sensitive information. Do not expose it publicly.

## Fingerprinting Algorithm Description

The server generates a fingerprint for each client by collecting specific HTTP request headers:

- User-Agent
- Accept
- Accept-Language
- Accept-Encoding
- Cookies

These headers are combined into an object, which is then serialized into a JSON string. The MD5 hash of this string is computed to produce a unique fingerprint. This fingerprint is used to:

- Identify returning clients.
- Assign a unique HTML page to each client.
- Log client information for analysis.

## Screenshots of Fingerprints

Below are screenshots demonstrating the fingerprints of different clients:

- **Client 1** (Chrome on Desktop)![alt text](chrome-fingerprint-1.png)
- **Client 2** (Firefox on Desktop)![alt text](fingerprinting-firefoxbrowser-1.png)
- **Client 3** (Opera on Kali Linux)![alt text](fingerprinting-kallinux-operabrowser-1.png)
- **Client 4** (Safari on iPhone)![alt text](fingerprinting-iphone-safari-1.png)
- **Client 5** (`curl` Command-Line Tool)![alt text](fingerprinting-curl-1.png)
- **client 6**(steamdeck using Brave Web Broswer)![alt text](fingerprinting-steamdeck-bravebrowser.-1.png)

**Note:** Replace the placeholder image filenames with actual screenshots from your testing.

## Video Demonstration

A video demonstrating the assignment can be found at the following link: **Assignment 6 Demonstration Video** (https://youtu.be/zLsQQuU-kIE)

## Author

- **Name:** Samuel Flores
- **Date:** December 1, 2024
